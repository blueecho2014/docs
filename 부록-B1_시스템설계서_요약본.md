# 시스템 설계서(요약본) — 1차년도 최소 증빙용

## 1. 문서 목적/범위
- **목적**: 1차년도 연구개발 수행결과를 “증빙 가능한 산출물” 형태로 정리하여 연차보고서에 첨부(부록)하기 위함
- **범위**: xAI 예측/설명 파이프라인(데이터→학습→평가→SHAP→산출물) 및 2차년도 확장(Agent/RAG/SaaS)까지의 시스템 개요

## 2. 시스템 개요(1차년도 기준)
- **핵심 기능**
  - **예측 모델 학습/평가**: RandomForestClassifier 기반 학습 및 Accuracy/AUC 산출
  - **설명(해석) 산출**: TreeExplainer 기반 SHAP 계산 → Top-N 중요도 집계(CSV) + 막대그래프(PNG) 생성
  - **증빙 산출물 저장**: 예측/설명 결과 파일을 로컬에 저장하여 재현/검증 가능
- **실행 스크립트(증빙)**: `Xai_ex.py`

## 3. 데이터 구성(입력/출력)
### 3.1 입력 데이터(로컬 파일)
- `data/irt_1216_all.csv`: IRT 관련 데이터(문항 파라미터 등)
- `data/toctoc_1216.csv`: 답안/학습 로그 데이터(사용자·문항·반응시간 등)

### 3.2 모델 입력 피처(예시)
`Xai_ex.py` 기준 모델 피처는 다음과 같은 범주로 구성됨:
- **식별/세션**: `member_id`, `rcset_id`, `question_id`
- **행동/로그**: `duration`, `response_count` 등
- **콘텐츠/학습 맥락**: `grade_cd`, `semstr_cd`, `lsn_cd`, `mode_id`, `conts_dtl_qitem_type_se_cd` 등
- **IRT 파라미터**: `Discrimination`, `Difficulty` 등

### 3.3 출력(산출물)
- **예측 성능(콘솔 로그)**: Accuracy, AUC
- **SHAP 중요도(Top-N)**
  - `shap_top20_member0.csv`, `shap_top20_member0.png`
  - `shap_top20_member1.csv`, `shap_top20_member1.png`
- **샘플 입력(JSON)**: `example1.json`, `example2.json`

## 4. 처리 흐름(1차년도 파이프라인)
1) CSV 로드 → 전처리(불필요 컬럼 제거/타겟 분리)  
2) 학습/테스트 분할 → 모델 학습(RandomForest)  
3) 성능 평가(Accuracy/AUC)  
4) 특정 사용자(`member_id==0/1`) 샘플 추출(최대 1000건)  
5) SHAP 계산(TreeExplainer)  
6) feature별 \(mean(|SHAP|)\) 계산 후 Top-N 저장(CSV/PNG)  
7) 샘플 입력 JSON 저장(재현/검증용)  

## 5. 1차년도 확인된 파일럿 성능(증빙)
- **Accuracy**: 0.90760759261228
- **AUC**: 0.662563032913503

> 주: 위 수치는 `Xai_ex.py` 실행 기반의 “내부 파일럿 결과”이며, 계획서의 정량지표 정의(수준진단/취약진단/해석 지표) 및 공인시험성적서 기반 검증은 2차년도에 수행 예정.

## 6. 2차년도 확장 설계(요약)
- **Agent/LLM 연계**: SHAP 결과 및 예측 결과를 구조화(JSON/Markdown)하여 LLM이 근거 기반 설명을 생성하도록 확장
- **RAG/VectorDB**: 교육 문서/가이드/도메인 지식 등을 색인하여 설명 품질/일관성 강화
- **SaaS 운영화**: API/권한/로그/모니터링/배포(CI/CD) 포함

## 7. 첨부(증빙) 목록(본 문서 기준)
- 코드: `Xai_ex.py`
- 결과: `shap_top20_member0.csv/png`, `shap_top20_member1.csv/png`, `example1.json`, `example2.json`


