# RAG / Vector DB 설계서(요약본) — 1차년도 “구조 설계(Agent+RAG)” 증빙용

## 1. 목적
- 1차년도에 정의한 “sLLM + RAG + Vector DB 기반 지식 연계 방식”을 **검증 가능한 설계 산출물**로 정리한다.

## 2. 설계 목표
- **설명 신뢰도 향상**: 모델 해석(SHAP) + 근거 문서(RAG)를 결합해 “근거 제시형 설명” 제공
- **일관성 확보**: 동일 조건에서 유사한 설명이 재현되도록 템플릿/규칙 및 지식 소스 고정
- **운영 가능성**: 지식 소스 추가/갱신, 버전 관리, 접근 권한 통제, 로그 추적 지원

## 3. 지식 소스 정의(예시)
Vector DB에 적재할 지식은 아래 범주로 분류한다.
- **교육/도메인 문서**: 교육과정 해설, 개념 정의, 오개념 사례
- **서비스/콘텐츠 메타**: 문항 메타데이터(유형/난이도/개념), 학습 콘텐츠 설명
- **설명 가이드**: “SHAP 해석 가이드”, 사용자 피드백 작성 규칙
- **운영/FAQ**: 사용자 질의 응답, 정책/용어집

> 실제 소스 파일 목록은 2차년도에 운영 데이터 범위 확정 후 고정한다.

## 4. 인덱싱/임베딩 설계(요약)
- **Chunk 단위**: 문단/항목 단위(예: 300~800자)로 분할
- **메타데이터**: `source_type`, `doc_id`, `concept_id`, `grade`, `version`, `updated_at` 등
- **임베딩 모델**: (2차년도 선정/고정) — 다국어(한국어) 성능 고려
- **갱신 정책**: 문서 변경 시 재색인(버전 증가), 이전 버전 보관(감사/재현)

## 5. 검색(Retrieval) 전략(요약)
- **Top-k**: 기본 3~5 (질의 유형에 따라 가변)
- **필터링**: 학년/과목/개념/콘텐츠 타입 등 메타 필터 우선 적용
- **재랭킹(선택)**: 중요 질의(설명 품질 요구)에서 재랭킹 모델 적용(2차년도)

## 6. Agent 결합 설계(근거 제시 규칙)
- **입력 컨텍스트**: 예측 결과 + SHAP Top-N + 학습 이력 요약 + 사용자 질문
- **출력 규칙**
  - 설명문에는 **SHAP 기반 근거(Top feature)**와 **문서 근거(RAG citations)**를 함께 포함
  - 근거가 부족할 경우 “추정” 표현을 제한하고, 추가 정보 요청 또는 “확인 필요”로 응답
- **안전장치**
  - 금칙어/환각 방지 규칙, 출처 없는 단정 금지
  - 민감정보(개인 식별) 노출 제한

## 7. 품질 평가(2차년도 정량화 항목으로 연계)
- **근거 포함률**: 응답 중 citations 포함 비율
- **정답성/일관성**: 전문가 평가(루브릭) 또는 Q&A set 기반 자동평가
- **검색 품질**: hit@k, MRR 등

## 8. 증빙(연계 문서)
- 구성도: 부록 B-2
- API/데이터 흐름: 부록 B-4
- 1차년도 파일럿 산출물: `shap_top20_member*.csv/png`, `example*.json`


